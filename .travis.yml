language: node_js
node_js:
  - "10"
env:
  global:
    # Necessary to build Node.js 0.6 on Travis CI images
    - "CC=gcc-4.6 CXX=g++-4.6"

dist: trusty
addons:
  apt:
    packages:
      - g++-4.6
sudo: required

cache:
  directories:
    - node_modules

before_install:
  # Skip updating shrinkwrap / lock
  - "npm config set shrinkwrap false"

  # Setup Node.js version-specific dependencies
  - "mysql -e 'CREATE DATABASE tip_test;'"
  - "test $(echo $TRAVIS_NODE_VERSION | cut -d. -f1) -ge 6 || npm rm --save-dev eslint"

  # Setup environment
  - "export MYSQL_DATABASE=tip_test"
  - "export MYSQL_HOST=localhost"
  - "export MYSQL_PORT=3306"
  - "export MYSQL_USER=root"
  - "export DB_HOST=tip_test"
  - "export DB_USERNAME=localhost"
  - "export DB_PORT=3306"
  - "export NODE_API_DB_NAME_TEST=root"
  - "export NODE_API_DB_NAME_TEST=tip_test"

install:
  - "npm install"
  - "npm install -g sequelize sequelize-cli pg mysql2"

script:
  # Run test script
  - "npm test"